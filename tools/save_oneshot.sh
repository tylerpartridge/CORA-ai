#!/usr/bin/env bash
set -euo pipefail
ts=$(date -u +%Y%m%d-%H%M%S); day=$(date -u +%Y/%m/%d); ck=/var/backups/cora/progress/$day/ckpt-$ts; mkdir -p "$ck"; git -C /var/www/cora rev-parse --short HEAD > "$ck/commit.txt" 2>/dev/null || true; git -C /var/www/cora status -s > "$ck/status.txt" 2>/dev/null || true; git -C /var/www/cora diff > "$ck/patch.diff" 2>/dev/null || true; tar -czf "$ck/repo.tgz" --warning=no-file-changed --exclude=.git --exclude=node_modules --exclude=venv --exclude=__pycache__ --exclude=*.db --exclude=*.db-* --exclude=logs/*.log* -C /var/www/cora .; printf "Saved checkpoint: %s at %s UTC\n" "$ck" "$(date -u -Is)" | tee -a /var/www/cora/docs/ai-awareness/AI_WORK_LOG.md >/dev/null
